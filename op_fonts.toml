[font]
name = "OpFont"
mode = "replace_gonoto"
output_dir = "dist"
weights = ["Regular", "Medium", "SemiBold", "Bold"]
languages_url = "https://raw.githubusercontent.com/commaai/openpilot/master/selfdrive/ui/translations/languages.json"

[font.weight_values]
Regular = 400
Medium = 500
SemiBold = 600
Bold = 700

[cache]
dir = "./cache"

# IBM Plex Sans — https://github.com/IBM/plex (OFL 1.1)
# Latin variable font includes Latin + Cyrillic. CJK/Thai are static per-weight.
[sources.cdn]
base_url = "https://raw.githubusercontent.com/IBM/plex/master/packages"
variant = "fonts/complete/otf"

[sources.cjk]
base_url = "https://raw.githubusercontent.com/IBM/plex/master/packages"

# =============================================================================
# Layer 1: CJK ideographs from official government standard character lists
# SC first, TC fills traditional-only gaps, JA fills remaining via pipeline dedup
# Union: ~6,318 unique CJK ideographs + punctuation/kana/fullwidth ranges
# =============================================================================

# Simplified Chinese: 通用规范汉字表 一级字表 (3,500 chars)
# PRC State Council, 2013 (国发〔2013〕23号)
[[scripts]]
name = "cjk-sc"
enabled = true
noto_font = "IBMPlexSansSC-Regular.otf"
noto_path = "plex-sans-sc/fonts/complete/otf/hinted"
charset_file = "charsets/sc_tongyong_l1.txt"
unicode_ranges = [
    "U+3000-303F",   # CJK Symbols and Punctuation
    "U+3040-309F",   # Hiragana
    "U+30A0-30FF",   # Katakana
    "U+31F0-31FF",   # Katakana Phonetic Extensions
    "U+3200-32FF",   # Enclosed CJK Letters and Months
    "U+FE30-FE4F",   # CJK Compatibility Forms
    "U+FF00-FFEF",   # Halfwidth and Fullwidth Forms
]

# Traditional Chinese: 常用國字標準字體表 (4,808 chars)
# Taiwan Ministry of Education, 1982 (revised 2004)
[[scripts]]
name = "cjk-tc"
enabled = true
noto_font = "IBMPlexSansTC-Regular.otf"
noto_path = "plex-sans-tc/fonts/complete/otf/hinted"
charset_file = "charsets/tc_edu_standard_1.txt"
unicode_ranges = [
    "U+3000-303F",   # CJK Symbols and Punctuation
]

# Japanese: 常用漢字 Jōyō Kanji (2,136 chars)
# Japanese Cabinet, 2010 (内閣告示第2号)
[[scripts]]
name = "cjk-ja"
enabled = true
noto_font = "IBMPlexSansJP-Regular.otf"
noto_path = "plex-sans-jp/fonts/complete/otf/hinted"
charset_file = "charsets/ja_joyo_kanji.txt"
unicode_ranges = [
    "U+3000-303F",   # CJK Symbols and Punctuation
    "U+3040-309F",   # Hiragana
    "U+30A0-30FF",   # Katakana
]

# Korean Hangul: KS X 1001 (2,350 syllables from full block of 11,172)
# Korean Agency for Technology and Standards, 1987
[[scripts]]
name = "hangul"
enabled = true
noto_font = "IBMPlexSansKR-Regular.otf"
noto_path = "plex-sans-kr/fonts/complete/otf"
charset_file = "charsets/ko_ksx1001_hangul.txt"
unicode_ranges = [
    "U+1100-11FF",   # Hangul Jamo
    "U+3130-318F",   # Hangul Compatibility Jamo
]

# =============================================================================
# Layer 2: Additional scripts not covered by CJK base
# =============================================================================

[[scripts]]
name = "thai"
enabled = true
noto_font = "IBMPlexSansThai-Regular.otf"
noto_path = "plex-sans-thai"
unicode_ranges = [
    "U+0E00-0E7F",   # Thai
]

# Cyrillic from static OTF (same as Latin, CFF outlines)
[[scripts]]
name = "cyrillic"
enabled = true
noto_font = "IBMPlexSans-Regular.otf"
noto_path = "plex-sans"
unicode_ranges = [
    "U+0400-04FF",   # Cyrillic
    "U+0500-052F",   # Cyrillic Supplement
]

# =============================================================================
# Layer 3: Latin, Symbols
# =============================================================================

[[scripts]]
name = "latin"
enabled = true
noto_font = "IBMPlexSans-Regular.otf"
noto_path = "plex-sans"
unicode_ranges = [
    "U+0000-007F",   # Basic Latin
    "U+0080-00FF",   # Latin-1 Supplement
    "U+0100-024F",   # Latin Extended-A/B
    "U+0250-02AF",   # IPA Extensions
    "U+1E00-1EFF",   # Latin Extended Additional (Vietnamese)
    "U+2000-206F",   # General Punctuation
    "U+2070-209F",   # Superscripts and Subscripts
    "U+20A0-20CF",   # Currency Symbols
    "U+2100-214F",   # Letterlike Symbols
    "U+2150-218F",   # Number Forms
    "U+FB00-FB06",   # Alphabetic Presentation Forms (ligatures)
]

# Symbols from Noto (IBM Plex doesn't include symbol fonts)
[symbols]
enabled = true
fonts = [
    { name = "NotoSansSymbols-Regular.ttf", url = "https://raw.githubusercontent.com/notofonts/notofonts.github.io/main/fonts/NotoSansSymbols/hinted/ttf/NotoSansSymbols-Regular.ttf" },
    { name = "NotoSansSymbols2-Regular.ttf", url = "https://raw.githubusercontent.com/notofonts/notofonts.github.io/main/fonts/NotoSansSymbols2/hinted/ttf/NotoSansSymbols2-Regular.ttf" },
]
unicode_ranges = [
    "U+2190-21FF",   # Arrows
    "U+2200-22FF",   # Mathematical Operators
    "U+2300-23FF",   # Miscellaneous Technical
    "U+25A0-25FF",   # Geometric Shapes
    "U+2600-26FF",   # Miscellaneous Symbols
    "U+2700-27BF",   # Dingbats (includes ✓ U+2713)
    "U+2B00-2BFF",   # Miscellaneous Symbols and Arrows
    "U+FFF0-FFFD",   # Specials (replacement char)
]

[emoji]
enabled = false

[merge]
drop_tables = ["MATH", "vhea", "vmtx"]
# Only keep essential layout features; drops stylistic alternates (ss01-ss06, salt),
# CJK variant forms (trad, jp78, jp83, jp90, hojo, nlck, expt), vertical writing
# (vert, vrt2), width alternates (fwid, hwid, pwid, pkna, nalt), and other features
# not needed for a car UI. This removes ~2000 unreferenced alternate glyphs.
keep_features = [
    "ccmp",  # glyph composition/decomposition
    "calt",  # contextual alternates
    "liga",  # standard ligatures (fi, fl)
    "locl",  # localized forms
    "frac",  # fractions
    "numr",  # numerators
    "dnom",  # denominators
    "lnum",  # lining figures
    "onum",  # oldstyle figures
    "subs",  # subscripts
    "sups",  # superscripts
    "zero",  # slashed zero
]
